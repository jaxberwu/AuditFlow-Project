# AuditFlow ä¼ä¸šçº§å®¡è®¡ç³»ç»Ÿè¯´æ˜

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å®Œå…¨ç‰©ç†éš”ç¦» + API è”åŠ¨è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CS_Simulator       â”‚         â”‚  AuditFlow_Engine   â”‚
â”‚  (Port 5001)        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  (Port 5002)        â”‚
â”‚                     â”‚  HTTP   â”‚                     â”‚
â”‚  CS_SimulatorDB     â”‚         â”‚  AuditFlowDB        â”‚
â”‚  (ç‹¬ç«‹æ•°æ®åº“)        â”‚         â”‚  (ç‹¬ç«‹æ•°æ®åº“)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                                â–²
         â”‚                                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  React Frontend â”‚
                  â”‚  (Port 5173)    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ç³»ç»Ÿ A: CS_Simulator (æ•°æ®æä¾›æ–¹)

### åŸºæœ¬ä¿¡æ¯
- **ç«¯å£**: 5001
- **æ•°æ®åº“**: CS_SimulatorDB (ç‹¬ç«‹)
- **DbContext**: `CS_SimulatorDbContext`

### æ•°æ®æ¨¡å‹
**CVEThreat å®ä½“**:
- `Id` (int, PK)
- `Hostname` (string) - æ ¼å¼: D + 5-8ä½éšæœºå­—æ¯æ•°å­—
- `CVE_ID` (string) - æ ¼å¼: CVE-YYYY-XXXXX
- `Severity` (string) - Critical/High/Medium/Low
- `Remediation` (string) - ä¿®å¤å»ºè®®
- `DetectedDate` (DateTime) - æ£€æµ‹æ—¥æœŸ

### ç§å­æ•°æ®
- **è‡ªåŠ¨ç”Ÿæˆ**: 50-100æ¡éšæœºCVEå¨èƒè®°å½•
- **ä¸»æœºæ•°é‡**: 10-15ä¸ªå”¯ä¸€ä¸»æœºå
- **ç”Ÿæˆæ—¶æœº**: æ•°æ®åº“ä¸ºç©ºæ—¶è‡ªåŠ¨ç”Ÿæˆ

### API ç«¯ç‚¹

#### 1. GET /api/v1/threats/summary
**åŠŸèƒ½**: è¿”å›æ‰€æœ‰è®¾å¤‡çš„ä¸»æœºååŠå…¶æ¼æ´æ€»æ•°

**å“åº”ç¤ºä¾‹**:
```json
{
  "hostThreatCounts": [
    {
      "hostname": "D7K2M9P",
      "threatCount": 5,
      "criticalCount": 2,
      "highCount": 1,
      "mediumCount": 2,
      "lowCount": 0
    }
  ],
  "totalThreats": 75,
  "totalHosts": 12
}
```

#### 2. GET /api/v1/threats/details/{hostname}
**åŠŸèƒ½**: è¿”å›æŒ‡å®šä¸»æœºçš„è¯¦ç»†CVEåˆ—è¡¨

**å“åº”ç¤ºä¾‹**:
```json
{
  "hostname": "D7K2M9P",
  "cves": [
    {
      "cve_ID": "CVE-2024-12345",
      "severity": "Critical",
      "remediation": "Apply security patch immediately",
      "detectedDate": "2024-01-15T00:00:00"
    }
  ],
  "totalCount": 5
}
```

---

## ğŸ” ç³»ç»Ÿ B: AuditFlow_Engine (å®¡è®¡å¼•æ“)

### åŸºæœ¬ä¿¡æ¯
- **ç«¯å£**: 5002
- **æ•°æ®åº“**: AuditFlowDB (ç‹¬ç«‹)
- **DbContext**: `AuditFlowDbContext`

### æ•°æ®æ¨¡å‹
**HardwareAsset å®ä½“**:
- `SN` (string, PK) - åºåˆ—å·
- `Hostname` (string) - ä¸»æœºå
- `PurchaseDate` (DateTime) - è´­ä¹°æ—¥æœŸ
- `Status` (string) - çŠ¶æ€

### ç§å­æ•°æ®
- **è®¾å¤‡æ•°é‡**: 5-10å°è®¾å¤‡
- **è´­ä¹°æ—¥æœŸ**: æ··åˆ2018å¹´å’Œ2024å¹´
- **ä¸»æœºåæ ¼å¼**: D + 5-8ä½éšæœºå­—æ¯æ•°å­—

### å®¡è®¡é€»è¾‘ (Q1-Q5)

**æ ¸å¿ƒåˆ¤å®šè§„åˆ™**:
```
IF (è®¾å¤‡åœ¨å¨èƒåå•ä¸­ AND è®¾å¤‡å¹´é¾„ >= 5å¹´)
    THEN Status = "Non-Compliant", Action = "Replace"
ELSE
    Status = "Compliant", Action = "Monitor"
```

**è¯¦ç»†é€»è¾‘**:
1. é€šè¿‡HttpClientè°ƒç”¨CS_Simulatorçš„ `/api/v1/threats/summary` API
2. è·å–æ‰€æœ‰ç¡¬ä»¶èµ„äº§ï¼ˆä»æœ¬åœ°æ•°æ®åº“ï¼‰
3. åŒ¹é…ä¸»æœºåï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¨èƒ
4. è®¡ç®—è®¾å¤‡å¹´é¾„ï¼ˆå½“å‰å¹´ä»½ - è´­ä¹°å¹´ä»½ï¼‰
5. åº”ç”¨åˆè§„æ€§åˆ¤å®šè§„åˆ™

### API ç«¯ç‚¹

#### GET /api/audit/summary
**åŠŸèƒ½**: è¿”å›æœ€ç»ˆçš„åˆè§„æ€§åˆ¤å®šæŠ¥å‘Š

**å“åº”ç¤ºä¾‹**:
```json
{
  "complianceItems": [
    {
      "sn": "SN001",
      "hostname": "D7K2M9P",
      "purchaseDate": "2018-06-15T00:00:00",
      "ageYears": 8,
      "status": "Non-Compliant",
      "action": "Replace",
      "threatCount": 5,
      "reason": "Device is 8 years old and has 5 threat(s)"
    }
  ],
  "totalAssets": 10,
  "compliantCount": 7,
  "nonCompliantCount": 3
}
```

---

## ğŸ¨ å‰ç«¯: AuditFlow.UI (React 19)

### æŠ€æœ¯æ ˆ
- React 19
- TypeScript
- Vite
- React 19 `use()` hook + Suspense

### æ ¸å¿ƒåŠŸèƒ½

#### 1. ä¸»è¡¨æ˜¾ç¤º
- æ˜¾ç¤ºæ‰€æœ‰è®¾å¤‡çš„åˆè§„çŠ¶æ€
- åˆ—åŒ…æ‹¬: SN, Hostname, Purchase Date, Age, Threat Count, Status, Action
- ç‚¹å‡»è¡Œå¯æŸ¥çœ‹è¯¦æƒ…ï¼ˆå¦‚æœæœ‰å¨èƒï¼‰

#### 2. ä¸‹é’»åŠŸèƒ½
- ç‚¹å‡»è®¾å¤‡è¡Œæˆ–"View CVEs"æŒ‰é’®
- å¼¹å‡ºæ¨¡æ€æ¡†æ˜¾ç¤ºè¯¥è®¾å¤‡çš„è¯¦ç»†CVEåˆ—è¡¨
- æ˜¾ç¤º: CVE ID, Severity, Detected Date, Remediation
- æ ‡æ³¨æ•°æ®æ¥æº: "Source: CrowdStrike API"

#### 3. æ•°æ®è·å–
- ä½¿ç”¨React 19çš„`use()` hookè·å–å®¡è®¡æ‘˜è¦
- ä½¿ç”¨`useEffect`è·å–å¨èƒè¯¦æƒ…ï¼ˆæ”¯æŒåŠ¨æ€åŠ è½½ï¼‰

---

## ğŸ” å®‰å…¨ä¸éš”ç¦»

### æ•°æ®åº“éš”ç¦»
- âœ… CS_SimulatorDB å’Œ AuditFlowDB å®Œå…¨ç‹¬ç«‹
- âœ… å„è‡ªä½¿ç”¨ç‹¬ç«‹çš„DbContext
- âœ… æ— æ•°æ®åº“å…±äº«ï¼Œæ— é¡¹ç›®å¼•ç”¨

### API é€šä¿¡
- âœ… Engineé€šè¿‡HttpClientè°ƒç”¨Simulator API
- âœ… ä½¿ç”¨é…ç½®åŒ–çš„API URL (`SimulatorApiUrl`)
- âœ… æ”¯æŒå°†æ¥æ›¿æ¢ä¸ºçœŸå®CrowdStrike API

### CORS é…ç½®
- âœ… ä¸¤ä¸ªåç«¯éƒ½é…ç½®äº†CORS
- âœ… å…è®¸å‰ç«¯ (http://localhost:5173) è®¿é—®
- âœ… å…è®¸æ‰€æœ‰HTTPæ–¹æ³•å’Œå¤´éƒ¨

---

## ğŸ“‹ API ç«¯ç‚¹æ€»ç»“

### CS_Simulator (Port 5001)
- `GET /api/v1/threats/summary` - å¨èƒæ‘˜è¦
- `GET /api/v1/threats/details/{hostname}` - å¨èƒè¯¦æƒ…

### AuditFlow_Engine (Port 5002)
- `GET /api/audit/summary` - å®¡è®¡æ‘˜è¦

---

## ğŸš€ è¿è¡Œæ­¥éª¤

### 1. å¯åŠ¨ CS_Simulator
```bash
cd AuditFlow.Simulator
dotnet run
```
- è‡ªåŠ¨åˆ›å»º CS_SimulatorDB æ•°æ®åº“
- è‡ªåŠ¨ç”Ÿæˆ 50-100 æ¡éšæœºCVEå¨èƒæ•°æ®

### 2. å¯åŠ¨ AuditFlow_Engine
```bash
cd AuditFlow.Engine
dotnet run
```
- è‡ªåŠ¨åˆ›å»º AuditFlowDB æ•°æ®åº“
- è‡ªåŠ¨ç”Ÿæˆ 5-10 å°è®¾å¤‡èµ„äº§æ•°æ®
- é€šè¿‡APIè°ƒç”¨Simulatorè·å–å¨èƒæ•°æ®

### 3. å¯åŠ¨å‰ç«¯
```bash
cd AuditFlow.UI
npm run dev
```
- è®¿é—® http://localhost:5173
- ä½¿ç”¨React 19 use() hookè·å–æ•°æ®
- æ”¯æŒä¸‹é’»æŸ¥çœ‹CVEè¯¦æƒ…

---

## ğŸ¯ å…³é”®ç‰¹æ€§

### âœ… Minimal API æ¨¡å¼
- æ‰€æœ‰ç«¯ç‚¹éƒ½åœ¨ `Program.cs` ä¸­ä½¿ç”¨ `app.MapGet()` å®šä¹‰
- æ— Controllerç±»ï¼Œä»£ç ç²¾ç®€

### âœ… å®Œå…¨éš”ç¦»
- ä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®åº“
- ä¸¤ä¸ªç‹¬ç«‹çš„DbContext
- æ— é¡¹ç›®å¼•ç”¨ï¼Œä»…é€šè¿‡HTTP APIé€šä¿¡

### âœ… ä¼ä¸šçº§è®¾è®¡
- æ¨¡æ‹ŸçœŸå®è·¨ç³»ç»Ÿå®¡è®¡åœºæ™¯
- æ”¯æŒå°†æ¥é›†æˆçœŸå®CrowdStrike API
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»

### âœ… React 19 ç‰¹æ€§
- ä½¿ç”¨ `use()` hookè¿›è¡Œæ•°æ®è·å–
- Suspenseå¤„ç†åŠ è½½çŠ¶æ€
- æ”¯æŒä¸‹é’»äº¤äº’

---

## ğŸ“ æ•°æ®æµç¨‹

1. **å‰ç«¯è¯·æ±‚** â†’ `GET /api/audit/summary`
2. **Engineå¤„ç†**:
   - ä»æœ¬åœ°æ•°æ®åº“è¯»å–ç¡¬ä»¶èµ„äº§
   - è°ƒç”¨Simulator APIè·å–å¨èƒæ‘˜è¦
   - åŒ¹é…ä¸»æœºåï¼Œåº”ç”¨å®¡è®¡è§„åˆ™
   - è¿”å›åˆè§„æ€§æŠ¥å‘Š
3. **å‰ç«¯æ˜¾ç¤º** â†’ ä¸»è¡¨å±•ç¤ºæ‰€æœ‰è®¾å¤‡çŠ¶æ€
4. **ç”¨æˆ·ç‚¹å‡»** â†’ è¯·æ±‚ `GET /api/v1/threats/details/{hostname}`
5. **Simulatorå“åº”** â†’ è¿”å›è¯¥ä¸»æœºçš„è¯¦ç»†CVEåˆ—è¡¨
6. **å‰ç«¯æ˜¾ç¤º** â†’ æ¨¡æ€æ¡†å±•ç¤ºCVEè¯¦æƒ…

---

## ğŸ”® æœªæ¥æ‰©å±•

### é›†æˆçœŸå®CrowdStrike API
åªéœ€ä¿®æ”¹ `CS_Simulator/Program.cs` ä¸­çš„APIç«¯ç‚¹ï¼š
```csharp
app.MapGet("/api/v1/threats/summary", async () => {
    var crowdStrikeClient = new CrowdStrikeApiClient();
    var threats = await crowdStrikeClient.GetThreatsAsync();
    return Results.Ok(threats);
});
```

### æ·»åŠ æ›´å¤šå®¡è®¡è§„åˆ™
åœ¨ `AuditFlow_Engine/Program.cs` ä¸­æ‰©å±•å®¡è®¡é€»è¾‘

### æ·»åŠ è®¤è¯æˆæƒ
åœ¨ä¸¤ä¸ªAPIä¸­æ·»åŠ JWTè®¤è¯æˆ–API KeyéªŒè¯

---

**æœ€åæ›´æ–°**: 2026-01-20 01:30
